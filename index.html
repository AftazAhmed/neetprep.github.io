<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NEET-PbP</title>
  <style>
    body { font-family: Montserrat,Arial,sans-serif; background: #f9fafb; color: #1f2937; margin:0; }
    .header { background: #023047; color: #ffb347; padding: 48px 24px 32px 24px; border-radius: 10px; margin-bottom: 32px; position:relative; }
    .header h1 { color: #ffa726; margin: 0 0 12px 0; font-size: 2.4rem; }
    .header .subtitle { color: #b9fbc0; font-size: 18px; }
    .login-section { position: absolute; top: 24px; right: 24px; z-index: 10; display: flex; gap: 12px; }
    .login-btn, .logout-btn, .sub-btn { background: linear-gradient(135deg, #667eea, #764ba2); color: #fff; border:none; padding:10px 20px;
      border-radius:8px; font-weight:700; font-size:14px; cursor:pointer; }
    .login-btn:hover, .logout-btn:hover, .sub-btn:hover { background: linear-gradient(135deg, #764ba2, #667eea);}
    .controls {display:flex;flex-wrap:wrap;gap:18px;margin-bottom:16px;justify-content:center;}
    .dropdown-group, .class-reload-group { min-width:170px; flex:1;}
    select {width:100%;padding:10px 14px;border-radius:8px;border:2px solid #028090;}
    .content-area { background: #fff1e0; padding: 28px 30px; border-radius: 12px; min-height: 300px; max-width: 900px; margin: 0 auto 30px auto; position: relative;}
    #questionsWrapper.blurred { filter: blur(6px); opacity:.7; pointer-events: none; user-select: none; }
    .curtain-overlay { position: absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.48);
      display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 15; border-radius: 12px; pointer-events: auto; }
    .curtain-message { font-size: 22px; font-weight: 800; color: #fff; margin-bottom: 8px; }
    .curtain-subtext { font-size: 16px; color:#cafac3; margin-bottom: 24px; }
    .sub-btn { font-size:16px; margin-bottom: 8px; }
    .question-count { font-weight: 700; font-size: 18px; color: #116466; margin-bottom: 18px; border-left: 5px solid #028090; padding-left: 14px; }
    .question-item { background-color: #fff8f0; border-radius: 12px; border: 1.5px solid #f0c49c; margin-bottom: 26px; padding: 20px 24px;}
    .question-number { font-weight:700; font-size:18px; color:#2a6f62;}
    .question-text { font-weight:600; font-size:15px; color:#255c4d; margin-bottom:14px;}
    .option { border-radius: 6px; border: 1.8px solid #b5d0c8; padding: 11px 18px; margin: 8px 0; font-weight: 500; background: #fff; color: #244636;
      transition: background-color 0.3s, border-color 0.3s, color 0.3s; cursor: pointer;}
    .no-questions {text-align:center;font-style:italic;color:#4a5768;font-size:17px;padding:48px 10px;}
    @media (max-width: 900px) { .controls { flex-direction:column;} .dropdown-group, .class-reload-group { min-width:unset;} }
  </style>
</head>
<body>
<div class="header">
  <div class="login-section" id="loginSection">
    <div id="gSignInWrapper">
      <button class="login-btn" id="googleSignInBtn">Sign in with Google</button>
    </div>
    <div id="userInfo" style="display:none;align-items:center;">
      <span id="userName"></span>
      <button class="logout-btn" onclick="handleLogout()">Logout</button>
    </div>
  </div>
  <h1>NEET-PbP</h1>
  <div class="subtitle">Page by Page Analysis (1988-2025)</div>
</div>
<div class="controls">
  <div class="class-reload-group">
    <div class="class-dropdown-part">
      <label for="classSelect">Class:</label>
      <select id="classSelect" onchange="updateChapters()">
        <option value="">Select Class</option>
        <option value="demo">Demo</option>
        <option value="11">Class 11</option>
        <option value="12">Class 12</option>
      </select>
    </div>
    <button class="reload-btn" onclick="window.location.reload()">â†» Reload</button>
  </div>
  <div class="dropdown-group">
    <label for="chapterSelect">Chapter:</label>
    <select id="chapterSelect" onchange="updatePages()" disabled>
      <option value="">Select Chapter</option>
    </select>
  </div>
  <div class="dropdown-group">
    <label for="pageSelect">Page Number:</label>
    <select id="pageSelect" onchange="showQuestions()" disabled>
      <option value="">Select Page</option>
    </select>
  </div>
</div>
<main class="content-area" id="contentArea">
  <div id="questionsWrapper"></div>
  <div class="curtain-overlay" id="curtainOverlay" style="display:none;">
    <div class="curtain-message">Subscribe to unlock content</div>
    <div class="curtain-subtext">Login and subscribe to view and interact with all NEET questions and pointers. Demo is always fully available.</div>
    <button class="sub-btn" id="subscribeBtn" style="display:none;">Subscribe (INR 200)</button>
  </div>
</main>
<script src="https://accounts.google.com/gsi/client" async defer></script>
<script>
const questionData = {
  "demo": { "2": { title: "Biological Classification", questions: {
    "10": [[{question:"Demo sample question?",options:["A", "B", "C", "D"],answer:"B"}], ""]
  }}},
  "11": { "1": { title: "The Living World", questions: {
    "3": [[{question:"Class 11 question, should be blurred till subscription",options:["One", "Two", "Three", "Four"],answer:"Three"}],"Summary for Class 11."]
  }}},
  "12": { "13": { title: "Biodiversity and Conservation", questions: {
    "216": [[{question:"Class 12 question, should be blurred till subscription",options:["X","Y","Z","W"],answer:"Z"}], "Summary for Class 12"]
  }}}
};
let currentUser = null, isSubscribed = false;

function updateLoginUI() {
  document.getElementById('userInfo').style.display = currentUser ? 'flex' : 'none';
  document.getElementById('gSignInWrapper').style.display = currentUser ? 'none' : 'block';
  document.getElementById('userName').textContent = currentUser ? `Welcome, ${currentUser.name}` : '';
}
function handleLogout() { currentUser = null; isSubscribed = false; localStorage.clear(); updateLoginUI(); showQuestions(); }
function loadPersistentData() {
  const user = localStorage.getItem('neet-pbp-user');
  if (user) currentUser = JSON.parse(user);
  const sub = localStorage.getItem('neet-pbp-subscription');
  isSubscribed = sub ? JSON.parse(sub) : false;
  updateLoginUI();
}
function initializeGoogleSignIn() {
  google.accounts.id.initialize({
    client_id: 'YOUR_GOOGLE_CLIENT_ID',
    callback: handleGoogleCredentialResponse,
    auto_select: false, ux_mode: 'popup'
  });
  document.getElementById('googleSignInBtn').onclick = () => google.accounts.id.prompt();
}
function handleGoogleCredentialResponse(response) {
  const userObj = parseJwt(response.credential);
  currentUser = { name: userObj.name, email: userObj.email, picture: userObj.picture };
  localStorage.setItem('neet-pbp-user', JSON.stringify(currentUser));
  updateLoginUI();
  showQuestions();
}
function parseJwt(token) {
  const base64Url = token.split('.')[1];
  const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
  return JSON.parse(decodeURIComponent(atob(base64).split('').map(c=>'%'+('00'+c.charCodeAt(0).toString(16)).slice(-2)).join('')));
}

window.onload = function() { loadPersistentData(); initializeGoogleSignIn(); };

function updateChapters() {
  const classSelect = document.getElementById('classSelect'), chapterSelect = document.getElementById('chapterSelect'), pageSelect = document.getElementById('pageSelect');
  const classValue = classSelect.value;
  chapterSelect.innerHTML = '<option value="">Select Chapter</option>'; chapterSelect.disabled = false;
  pageSelect.innerHTML = '<option value="">Select Page</option>'; pageSelect.disabled = true;
  if (classValue && questionData[classValue]) {
    for (const chapterNum in questionData[classValue]) {
      chapterSelect.innerHTML += `<option value="${chapterNum}">Chapter ${chapterNum}: ${questionData[classValue][chapterNum].title}</option>`;
    }
  }
}
function updatePages() {
  const classSelect = document.getElementById('classSelect'), chapterSelect = document.getElementById('chapterSelect'), pageSelect = document.getElementById('pageSelect');
  const classValue = classSelect.value, chapterValue = chapterSelect.value;
  pageSelect.innerHTML = '<option value="">Select Page</option>'; pageSelect.disabled = false;
  if (classValue && chapterValue && questionData[classValue][chapterValue]) {
    for (const pageNum in questionData[classValue][chapterValue].questions) {
      const len = questionData[classValue][chapterValue].questions[pageNum][0].length;
      pageSelect.innerHTML += `<option value="${pageNum}">Page ${pageNum} (${len} questions)</option>`;
    }
  }
}
function showQuestions() {
  const classValue = document.getElementById('classSelect').value;
  const chapterValue = document.getElementById('chapterSelect').value;
  const pageValue = document.getElementById('pageSelect').value;
  const questionsWrapper = document.getElementById('questionsWrapper');
  const curtain = document.getElementById('curtainOverlay');
  const subscribeBtn = document.getElementById('subscribeBtn');
  questionsWrapper.classList.remove("blurred"); curtain.style.display = "none"; subscribeBtn.style.display = "none";
  if (!classValue || !chapterValue || !pageValue) { questionsWrapper.innerHTML = ''; return; }
  let questionsData = questionData[classValue][chapterValue].questions[pageValue];
  let questionsArr = questionsData && questionsData.length && Array.isArray(questionsData[0]) ? questionsData[0] : [];
  let summaryStr = questionsData && questionsData.length && typeof questionsData[1]=="string" ? questionsData[1] : "";
  let html = '';
  if (summaryStr) html += `<div class="question-count">${summaryStr}</div>`;
  html += `<div class="question-count">Total Questions: ${questionsArr.length}</div>`;
  questionsArr.forEach((q, i) => {
    html += `<div class="question-item"><div class="question-header"><span class="question-number">Q${i+1}</span></div>
      <div class="question-text">${q.question}</div>
      <div class="options">${q.options.map(opt=>`<div class="option">${opt}</div>`).join('')}</div>
      <div><span style="font-size:13px;font-style:italic;color:#999;">Answer: ${q.answer}</span></div></div>`;
  });
  questionsWrapper.innerHTML = html;

  // Curtain on 11/12 only if not subscribed
  if (classValue !== "demo" && (!currentUser || !isSubscribed)) {
    questionsWrapper.classList.add("blurred");
    curtain.style.display = "flex";
    if (currentUser && !isSubscribed) subscribeBtn.style.display = "inline-block";
    else subscribeBtn.style.display = "none";
  } else {
    questionsWrapper.classList.remove("blurred");
    curtain.style.display = "none";
    subscribeBtn.style.display = "none";
  }
}
document.getElementById('subscribeBtn').onclick = function() {
  isSubscribed = true;
  localStorage.setItem('neet-pbp-subscription', JSON.stringify(true));
  showQuestions();
};
</script>
</body>
</html>
